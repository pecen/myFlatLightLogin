<mah:MetroWindow
    x:Class="myFlatLightLogin.UI.Wpf.MVVM.View.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:behavior="clr-namespace:myFlatLightLogin.UI.Wpf.Behavior"
    xmlns:converter="clr-namespace:myFlatLightLogin.UI.Wpf.Converter"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:extension="clr-namespace:myFlatLightLogin.UI.Wpf.Extension"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:myFlatLightLogin.UI.Wpf.MVVM.ViewModel"
    Width="1024"
    Height="720"
    d:DataContext="{d:DesignInstance Type=vm:MainWindowViewModel}"
    AllowsTransparency="True"
    Background="Transparent"
    Closing="MetroWindow_Closing"
    ResizeMode="NoResize"
    ShowMaxRestoreButton="False"
    ShowMinButton="False"
    ShowTitleBar="False"
    ShowCloseButton="False"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None"
    mc:Ignorable="d">
    <!--<Window.DataContext>
        <vm:MainWindowViewModel />
    </Window.DataContext>-->

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
        <converter:BoolToVisibilityPwdText x:Key="BoolToVisPwd" />
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  Top Section  -->
        <Border
            Padding="10"
            Background="White"
            BorderBrush="#e2e9e9"
            BorderThickness="0,0,0,2"
            CornerRadius="5 5 0 0">
            <Border.InputBindings>
                <MouseBinding Command="{Binding MoveWindowCommand}" MouseAction="LeftClick" />
                <MouseBinding Command="{Binding ResizeWindowCommand}" MouseAction="LeftDoubleClick" />
            </Border.InputBindings>
            <Grid>
                <Button HorizontalAlignment="Left" Style="{StaticResource topButton}">
                    <icon:PackIconMaterial Kind="Magnify" Style="{StaticResource topButtonIcon}" />
                </Button>

                <!--<icon:PackIconMaterial
                    Width="22"
                    Height="22"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Foreground="#ff131e"
                    Kind="Microsoft" />-->

                <Button
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Command="{Binding ResizeWindowCommand}"
                    Style="{StaticResource topButton}">
                    <icon:PackIconMaterial
                        Width="22"
                        Height="22"
                        Kind="Microsoft"
                        Style="{StaticResource topButtonIcon}" />
                </Button>

                <Button
                    HorizontalAlignment="Right"
                    Command="{Binding ShutdownWindowCommand}"
                    Style="{StaticResource topButton}">
                    <icon:PackIconMaterial Kind="ExitToApp" Style="{StaticResource topButtonIcon}" />
                </Button>
            </Grid>
        </Border>

        <!--  Middle Section  -->
        <Grid Grid.Row="1">
            <Grid.Background>
                <SolidColorBrush Color="WhiteSmoke" />
            </Grid.Background>

            <Grid>
                <Grid.Background>
                    <ImageBrush ImageSource="/Assets/Images/Ionion_Cyprus.jpg" Opacity="0.5" />
                </Grid.Background>
            </Grid>
        </Grid>

        <!--  Input Form  -->
        <ContentPresenter Grid.Row="1" Content="{Binding Navigation.CurrentView}" />

        <!--  Bottom Section  -->
        <Border
            Grid.Row="2"
            Padding="10"
            Background="White"
            BorderBrush="#e2e9e9"
            BorderThickness="0,2,0,0"
            CornerRadius="0 0 5 5">
            <Grid>
                <!--  Copyright Text  -->
                <TextBlock
                    Margin="15,0"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center"
                    FontSize="13"
                    Foreground="#909090"
                    Text="Copyright 2023. All rights reserved." />

                <!--  Menu Buttons  -->
                <StackPanel
                    Margin="10"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal">
                    <Button
                        Content="Home"
                        IsEnabled="{Binding IsUserLoggedIn}"
                        Style="{StaticResource bottomButton}" />
                    <Button
                        Content="Features"
                        IsEnabled="{Binding IsUserLoggedIn}"
                        Style="{StaticResource bottomButton}" />
                    <Button
                        Content="Solutions"
                        IsEnabled="{Binding IsUserLoggedIn}"
                        Style="{StaticResource bottomButton}" />
                    <Button
                        Content="Videos"
                        IsEnabled="{Binding IsUserLoggedIn}"
                        Style="{StaticResource bottomButton}" />
                    <Button
                        Content="About"
                        IsEnabled="{Binding IsUserLoggedIn}"
                        Style="{StaticResource bottomButton}" />

                    <!--  Admin-Only Sync Menu  -->
                    <Menu
                        Background="Transparent"
                        Visibility="{Binding IsUserAdministrator, Converter={StaticResource BoolToVis}}">
                        <MenuItem
                            Height="37"
                            Padding="10,0"
                            Background="Transparent"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="#5e5e5e">
                            <MenuItem.Header>
                                <StackPanel Orientation="Horizontal">
                                    <icon:PackIconMaterial
                                        Width="14"
                                        Height="14"
                                        Margin="0,0,5,0"
                                        VerticalAlignment="Center"
                                        Kind="Sync"
                                        Spin="{Binding IsSyncing}" />
                                    <TextBlock Text="Sync" VerticalAlignment="Center" />
                                </StackPanel>
                            </MenuItem.Header>
                            <MenuItem.Style>
                                <Style TargetType="MenuItem">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="MenuItem">
                                                <Border
                                                    x:Name="Border"
                                                    Background="{TemplateBinding Background}"
                                                    BorderThickness="0">
                                                    <Grid>
                                                        <ContentPresenter
                                                            Margin="{TemplateBinding Padding}"
                                                            ContentSource="Header"
                                                            RecognizesAccessKey="True" />
                                                        <Popup
                                                            x:Name="Popup"
                                                            AllowsTransparency="True"
                                                            Focusable="False"
                                                            IsOpen="{TemplateBinding IsSubmenuOpen}"
                                                            Placement="Top"
                                                            PopupAnimation="Fade">
                                                            <Border
                                                                Padding="5"
                                                                Background="White"
                                                                BorderBrush="#e2e9e9"
                                                                BorderThickness="1"
                                                                CornerRadius="5">
                                                                <Border.Effect>
                                                                    <DropShadowEffect
                                                                        BlurRadius="10"
                                                                        Direction="270"
                                                                        Opacity="0.3"
                                                                        ShadowDepth="2" />
                                                                </Border.Effect>
                                                                <StackPanel IsItemsHost="True" />
                                                            </Border>
                                                        </Popup>
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Border" Property="Background" Value="Transparent" />
                                                        <Setter Property="Foreground" Value="#ff131e" />
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </MenuItem.Style>

                            <!--  Sync Status Display  -->
                            <MenuItem
                                Background="White"
                                FontSize="11"
                                Foreground="#606060"
                                IsEnabled="False">
                                <MenuItem.Header>
                                    <StackPanel>
                                        <TextBlock
                                            Padding="5"
                                            FontWeight="SemiBold"
                                            Text="{Binding SyncStatusMessage}" />
                                    </StackPanel>
                                </MenuItem.Header>
                            </MenuItem>

                            <Separator />

                            <!--  Sync Now Action  -->
                            <MenuItem
                                Command="{Binding SyncNowCommand}"
                                FontSize="12"
                                Header="Sync Now"
                                ToolTip="Manually sync pending users to Firebase">
                                <MenuItem.Icon>
                                    <icon:PackIconMaterial
                                        Width="14"
                                        Height="14"
                                        Kind="CloudUpload" />
                                </MenuItem.Icon>
                            </MenuItem>
                        </MenuItem>
                    </Menu>

                    <!--  Admin-Only Logs Menu  -->
                    <Menu
                        Background="Transparent"
                        Visibility="{Binding IsUserAdministrator, Converter={StaticResource BoolToVis}}">
                        <MenuItem
                            Height="37"
                            Padding="10,0"
                            Background="Transparent"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="#5e5e5e">
                            <MenuItem.Header>
                                <StackPanel Orientation="Horizontal">
                                    <icon:PackIconMaterial
                                        Width="14"
                                        Height="14"
                                        Margin="0,0,5,0"
                                        VerticalAlignment="Center"
                                        Kind="FileDocument" />
                                    <TextBlock Text="Logs" VerticalAlignment="Center" />
                                </StackPanel>
                            </MenuItem.Header>
                            <MenuItem.Style>
                                <Style TargetType="MenuItem">
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="MenuItem">
                                                <Border
                                                    x:Name="Border"
                                                    Background="{TemplateBinding Background}"
                                                    BorderThickness="0">
                                                    <Grid>
                                                        <ContentPresenter
                                                            Margin="{TemplateBinding Padding}"
                                                            ContentSource="Header"
                                                            RecognizesAccessKey="True" />
                                                        <Popup
                                                            x:Name="Popup"
                                                            AllowsTransparency="True"
                                                            Focusable="False"
                                                            IsOpen="{TemplateBinding IsSubmenuOpen}"
                                                            Placement="Top"
                                                            PopupAnimation="Fade">
                                                            <Border
                                                                Padding="5"
                                                                Background="White"
                                                                BorderBrush="#e2e9e9"
                                                                BorderThickness="1"
                                                                CornerRadius="5">
                                                                <Border.Effect>
                                                                    <DropShadowEffect
                                                                        BlurRadius="10"
                                                                        Direction="270"
                                                                        Opacity="0.3"
                                                                        ShadowDepth="2" />
                                                                </Border.Effect>
                                                                <StackPanel IsItemsHost="True" />
                                                            </Border>
                                                        </Popup>
                                                    </Grid>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Border" Property="Background" Value="Transparent" />
                                                        <Setter Property="Foreground" Value="#ff131e" />
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </MenuItem.Style>

                            <!--  View Current Log  -->
                            <MenuItem
                                Command="{Binding ViewCurrentLogCommand}"
                                FontSize="12"
                                Header="View Current Log"
                                ToolTip="Open current log file">
                                <MenuItem.Icon>
                                    <icon:PackIconMaterial
                                        Width="14"
                                        Height="14"
                                        Kind="FileEye" />
                                </MenuItem.Icon>
                            </MenuItem>

                            <!--  Open Logs Folder  -->
                            <MenuItem
                                Command="{Binding OpenLogsFolderCommand}"
                                FontSize="12"
                                Header="Open Logs Folder"
                                ToolTip="Open logs folder in Explorer">
                                <MenuItem.Icon>
                                    <icon:PackIconMaterial
                                        Width="14"
                                        Height="14"
                                        Kind="FolderOpen" />
                                </MenuItem.Icon>
                            </MenuItem>
                        </MenuItem>
                    </Menu>

                    <Button
                        Command="{Binding NavigateToLoginCommand}"
                        Content="Login"
                        Foreground="#ff131e"
                        Style="{StaticResource bottomButton}" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</mah:MetroWindow>
